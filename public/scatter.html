<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Gumi PC방 이용료 Pie</title>
  <link rel="stylesheet" href="./vendor/apexcharts/dist/apexcharts.css" />
  <script src="./vendor/apexcharts/dist/apexcharts.js"></script>
</head>
<body>
  <h2 style="text-align:center;">🥧 구미 PC방 이용료 Pie 차트</h2>
  <div id="chart"></div>

  <script>
    fetch(`http://localhost:3000/api/gumi`) 
      .then(res => res.json())
      .then(json => {
        const data = json;

        // Pie Chart 데이터 변환
        const seriesData = data.map(item => item.pc);     // 가격 배열
        const labelsData = data.map(item => item.se);     // 행정구역 배열

        const options = {
          chart: {
            type: "pie",
            height: 400
          },
          series: seriesData,
          labels: labelsData,
          tooltip: {
            y: {
              formatter: function(value, { seriesIndex }) {
                const item = data[seriesIndex];
                return `${item.prdlst_nm} : ${value.toLocaleString()}원<br/>기준일: ${item.date_stdde}`;
              }
            }
          },
          colors: ["#3B82F6", "#10B981", "#F59E0B", "#EF4444", "#6366F1", "#EC4899", "#14B8A6"]
        };

        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
      })
      .catch(err => {
        console.error("데이터 로드 실패:", err);
      });
  </script>
</body>
</html>
